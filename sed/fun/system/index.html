<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>4906.org &gt; SED &gt; Fun stuff &gt; System</title>
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon.png"/>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/>
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/>
  <link rel="manifest" href="/site.webmanifest"/>
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"/>
  <link rel="stylesheet" href="/index.css"/>
  <meta name="msapplication-TileColor" content="#da532c"/>
  <meta name="theme-color" content="#ffffff"/>
</head>
<body>
  <canvas width="100vw" height="100vh" id="tinycanvas"/>
  <canvas id="buffer" display="none"/>
  <script>
    function colormul(data,r,g,b,a) {
      for (var i = 0; i < data.length; i += 4) {
        data[i]     = data[i] * r;     // red
        data[i + 1] = data[i + 1] * g; // green
        data[i + 2] = data[i + 2] * b; // blue
        data[i + 3] = data[i + 3] * a; // alpha
      }
      return data;
    }
    function rendertextcolor(str,x,y,w,h,r,g,b,a) {
      const canvasb = document.getElementById('buffer');
      const ctxb = canvasb.getContext('2d');
      ctxb.clearRect(0,0,canvasb.width,canvasb.height);
      img = new Image();
      img.onload = () => {
        cx=0;
        cy=0;
        for(i=0;i<str.length;i++) {
          if(32 <= str.charCodeAt(i) <= 126){
            if(str[i] == '\n') {cy++; cx=0;}
            else {
              if(cx <= w/4 && cy <= h/6) {
                ctxb.drawImage(img, Math.min(str.charCodeAt(i)*4, 127*4), 0, 4, 6, x+cx*4, y+cy*6, 4, 6);
              }
              cx++;
            }
          }
        }

        const canvas = document.getElementById('tinycanvas');
        const ctx = canvas.getContext('2d');
        imgdata = ctxb.getImageData(0,0,canvasb.width,canvasb.height);
        imgdata.data = colormul(imgdata.data,r,g,b,a);
        ctx.putImageData(imgdata, x, y);
      }
      img.onerror = err => { throw err }
      img.crossOrigin = "Anonymous";
      img.src = 'http://4906.org/sed/fun/system/4x6tw.png';
    }
    function makeithappen() {
      rendertextcolor("test",0,0,16,6,1,0,0,1);
    }
    makeithappen();
  </script>
</body>
</html>
